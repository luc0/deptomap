

<div id="mapa">
  <input id="inputFilterPriceMin" type="text" v-model="filterPriceMin">
  <input id="inputFilterPriceMax" type="text" v-model="filterPriceMax">
  <div id="slider"></div>
    <google-map
      :center="center"
      :zoom="12"
      style="width: 100%; height: 500px"
    >
      <google-marker
        v-for="m in filteredMarkers"
        :position="m.position"
        :clickable="true"
        :draggable="true"
        @click="center=m.position"
      ></google-marker>
    </google-map>
</div>

<script type="text/javascript">

  var FLATS = '<%= flats %>'

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.8/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js"></script>
<script src="js/vue-google-maps.js"></script>

<script>

  FLATS = parseJSON( FLATS );

  Vue.use(VueGoogleMap, {
    load: {
      'key': 'AIzaSyArDyFoJj9j04gOY0DhQ77bCaU-JxKhTtA'
    },
    // Demonstrating how we can customize the name of the components
    installComponents: false,
  });

  document.addEventListener('DOMContentLoaded', function() {
      Vue.component('google-map', VueGoogleMap.Map);
      Vue.component('google-marker', VueGoogleMap.Marker);
      var map = new Vue({
          el: '#mapa',
          data: {
            center: {lat: -34.5942865, lng: -58.4301075},
            markers: FLATS,
            filterPriceMin: 5000,
            filterPriceMax: 9000
          },
          computed:{
            filteredMarkers: function(){
              var self = this
              return self.markers.filter(function (marker) {
                console.log('filterPriceMax',self.filterPriceMin)
                return (marker.price > self.filterPriceMin) && (marker.price < self.filterPriceMax) 
              })
            }
          }
      });

      var slider = document.getElementById('slider');

      noUiSlider.create(slider, {
        start: [6000, 8000],
        connect: true,
        range: {
          'min': 5000,
          'max': 22000
        }
      });

      var inputNumberMin = document.getElementById('inputFilterPriceMin');
      var inputNumberMax = document.getElementById('inputFilterPriceMax');

      slider.noUiSlider.on('update', function( values, handle ) {

        var value = values[handle];

        if ( handle ) {
          inputNumberMax.value = value;
          map.filterPriceMax = inputNumberMax.value;
        } else {
          inputNumberMin.value = Math.round(value);
          map.filterPriceMin = inputNumberMin.value;
        }

      });

      inputNumberMin.addEventListener('change', function(){
        slider.noUiSlider.set([this.value, null]);
      });

      inputNumberMax.addEventListener('change', function(){
        slider.noUiSlider.set([null, this.value]);
      });


  });

  function parseJSON( obj ){
    
    obj = obj.replace(/\\n/g, "\\n")  
       .replace(/\\'/g, "\\'")
       .replace(/\\"/g, '\\"')
       .replace(/\\&/g, "\\&")
       .replace(/\\r/g, "\\r")
       .replace(/\\t/g, "\\t")
       .replace(/\\b/g, "\\b")
       .replace(/\\f/g, "\\f")
       .replace(/\&quot;/g, '"')
       .replace(/\&#34;/g, '"')
       .replace(/[\u0000-\u0019]+/g,"");

    return JSON.parse( obj );

  }

</script>